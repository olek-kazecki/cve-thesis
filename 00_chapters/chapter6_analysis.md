# Analiza przeżycia

W tej sekcji przeprowadzę analizę przeżycia linii kodu występujących w naprawach błędów w zbiorze HaPy-Bug, w szczególności z podziałem na kategorie linii oraz podzbiory cve, crawl i bugsinpy. Tym samym postaram się odpowiedzieć na pytanie badawcze RQ2.

W tym badaniu interesującym nas zdarzeniem z perspektywy analizy przeżycia będzie koniec istnienia danej linii kodu w pliku, a więc sytuacja, w której została ona usunięta bądź zmieniona lub plik, w którym znajdowała się linia, został usunięty albo przeniesiony. Do ustalenia momentu zdarzenia posłuży nam polecenie git blame, które przy użyciu opcji reverse, podaje informację o tym, kiedy ostatni raz dana linia pojawiła się w pliku.

Jak można się spodziewać, w naprawach błędów będą pojawiały się też linie, które od czasu wprowadzenia naprawy nie zostały w żaden sposób zmodyfikowane ani usunięte. Innymi słowy, zdarzenie dla tej linii nie wystąpiło. W danych będą więc występować obserwacje prawostronnie cenzurowane.

Narzędzie git log posłużyło mi do ustalenia czasów ostatniej modyfikacji poszczególnych plików. W ten sposób możemy uzyskać informacje o obserwacjach cenzurowanych: uznajemy, że linia kodu przetrwała, jeżeli czas jej ostatniego wystąpienia w pliku jest równy czasowi ostatniej modyfikacji pliku.

Data początkowa linii kodu jest datą migawki, z której ona pochodzi. Data końcowa to data zwracana dla tej linijki przez polecenie git blame z opcją reverse. Czas przeżycia linii kodu określamy jako czas, jaki upłynął od jej daty początkowej do daty końcowej. Jeżeli data końcowa pokrywa się z datą ostatniej modyfikacji pliku, to oznacza, że ta linia kodu przetrwała, więc jest obserwacją prawostronnie cenzurowaną.

Ponieważ intreresują nas linie kodu wprowadzone w naprawach błędów, bierzemy pod uwagę tylko obserwacje, gdzie zmienna image ma wartość "afterChange".

Następne 6 rysunków przedstawia wykresy funkcji przeżycia wygenerowane przy pomocy biblioteki lifelines napisanej w Pythonie. Modelem użytym do obliczenia funkcji przeżycia był estymator Kaplana-Meiera. Pionowa oś oznacza prawdopodobieństwo przeżycia, a pozioma -- czas życia w dniach.

Wykresy \ref{cve_surv}, \ref{crawl_surv} i \ref{bip_surv} przedstawiają funkcje przeżycia dla zbiorów cve, crawl i bugsinpy odpowiednio.

Najlepsze rokowania możemy zaobserwować dla zbioru cve: na wykresie prawdopodobieństwo pomimo gwałtownego spadku na początku nie schodzi poniżej 0,3. W zbiorze crawl spadek jest większy: jeszcze przed 1000 dni prawdopodobieństwo spada do 0,3, a przy 5000 wynosi około 0,1. Wykres dla zbioru bugsinpy jest najbardziej gładki i prawdopodobieństwo nie spada poniżej 0,2.

![Wykres funkcji przeżycia zmienionych linii kodu w zbiorze cve \label{cve_surv}](03_figures/img/cve_surv.png)

![Wykres funkcji przeżycia zmienionych linii kodu w zbiorze cve z podziałem na kategorie oznaczeń \label{cve_annotation_surv}](03_figures/img/cve_annotation_surv.png)

![Wykres funkcji przeżycia zmienionych linii kodu w zbiorze crawl \label{crawl_surv}](03_figures/img/crawl_surv.png)

![Wykres funkcji przeżycia zmienionych linii kodu w zbiorze crawl z podziałem na kategorie oznaczeń \label{crawl_annotation_surv}](03_figures/img/crawl_annotation_surv.png)

![Wykres funkcji przeżycia zmienionych linii kodu w zbiorze bugsinpy \label{bip_surv}](03_figures/img/bip_surv.png)

![Wykres funkcji przeżycia zmienionych linii kodu w zbiorze bugsinpy z podziałem na kategorie oznaczeń \label{bip_annotation_surv}](03_figures/img/bip_annotation_surv.png)
